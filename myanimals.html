<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creature Comfort - My Animals</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="logo">
      <img src="logo.png" alt="Creature Comfort Logo">
    </div>
    <nav class="main-nav">
      <a href="index.html">Home</a>
      <a href="myanimals.html">My Animals</a>
      <a href="careguides.html">Care Guide</a>
      <a href="survey.html">Survey</a>
    </nav>
    <button class="login-btn">Login</button>
  </header>

  <!-- Main Content -->
<main>
  <h1 class="my-animals-title">My Animals</h1>

  <div class="myanimals-container">

    <!-- LEFT COLUMN: Pet Profiles -->
    <section class="pet-profiles">
      <h2>Pet Profiles</h2>
      <div class="pet-list">

        <div class="pet-card">
          <img src="dogmyanimals.jpg" alt="Lincoln the dog">
          <div class="pet-info">
            <strong>Lincoln</strong><br>
            <b>Species:</b> Dog<br>
            <b>Diet:</b> Kibble every AM and PM<br>
            <b>Notes:</b> Favors females over males, tends to have allergies in the spring.
          </div>
          <button class="health-log-btn">Health Log</button>
        </div>

        <div class="pet-card">
          <img src="catmyanimals.jpg" alt="Charlie the cat">
          <div class="pet-info">
            <strong>Charlie</strong><br>
            <b>Species:</b> Cat<br>
            <b>Diet:</b> Dry Food & Wet Food everyday<br>
            <b>Notes:</b> Takes lots of naps.
          </div>
          <button class="health-log-btn">Health Log</button>
        </div>

        <div class="pet-card">
          <img src="fishmyanimals.jpg" alt="Goldie the fish">
          <div class="pet-info">
            <strong>Goldie</strong><br>
            <b>Species:</b> Fish<br>
            <b>Diet:</b> Fish food once in the AM<br>
            <b>Notes:</b> Very easy to take care of.
          </div>
          <button class="health-log-btn">Health Log</button>
        </div>

      </div>
    </section>

    <!-- RIGHT COLUMN: Add Pet Form -->
    <section class="add-pet">
      <h2>Add Pet</h2>
      <form>
        <label for="petname">Pet Name</label>
        <input type="text" id="petname" name="petname">

        <label for="species">Species</label>
        <input type="text" id="species" name="species">

        <label for="dob">Date of Birth</label>
        <input type="date" id="dob" name="dob">

        <label for="diet">Diet</label>
        <input type="text" id="diet" name="diet">

        <label for="notes">Notes</label>
        <textarea id="notes" name="notes"></textarea>

        <label for="photo">Enter Photo</label>
        <input type="file" id="photo" name="photo">

        <button type="submit">Add New Pet</button>
      </form>
    </section>

  </div>
</main>

  <!-- Footer -->
 <footer class="site-footer">
  <div class="footer-left">
    <img src="logo.png" alt="Creature Comfort Logo">
  </div>
  
  <p>Â© 2025 CreatureComfort, Inc</p>
  
  <a href="mailto:info@creaturecomfort.com">Email Us :)</a>
  <a href="#">Legal Stuff</a>
  <a href="#">Privacy Policy</a>
</footer>
<!-- Put this just before </body> in myanimals.html -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const petListEl = document.querySelector('.pet-list');
  const form = document.querySelector('.add-pet form');
  const photoInput = document.getElementById('photo');

  // Storage keys
  const PETS_KEY = 'myanimals_pets'; // array of pet objects
  const PENDING_KEY = 'myanimals_pending_pet'; // single pet object written by survey page

  // ---- Utility: generate DOM for a pet and append ----
  function createPetCard(pet) {
    const card = document.createElement('div');
    card.className = 'pet-card';

    const img = document.createElement('img');
    img.alt = (pet.name ? pet.name + ' photo' : 'pet photo');
    img.src = pet.photoDataUrl || (pet.species && pet.species.toLowerCase().includes('dog') ? 'dogmyanimals.jpg'
                : pet.species && pet.species.toLowerCase().includes('cat') ? 'catmyanimals.jpg'
                : pet.species && pet.species.toLowerCase().includes('fish') ? 'fishmyanimals.jpg'
                : 'placeholder.png'); // fallback

    const info = document.createElement('div');
    info.className = 'pet-info';
    info.innerHTML = `<strong>${escapeHtml(pet.name || 'Unnamed')}</strong><br>
                      <b>Species:</b> ${escapeHtml(pet.species || 'Unknown')}<br>
                      ${pet.dob ? `<b>DOB:</b> ${escapeHtml(pet.dob)}<br>` : ''}
                      <b>Diet:</b> ${escapeHtml(pet.diet || 'N/A')}<br>
                      <b>Notes:</b> ${escapeHtml(pet.notes || '')}`;

    const btn = document.createElement('button');
    btn.className = 'health-log-btn';
    btn.textContent = 'Health Log';

    card.appendChild(img);
    card.appendChild(info);
    card.appendChild(btn);

    return card;
  }

  // Small helper to avoid XSS when injecting text
  function escapeHtml(str) {
    return String(str)
      .replaceAll('&', '&amp;')
      .replaceAll('<', '&lt;')
      .replaceAll('>', '&gt;')
      .replaceAll('"', '&quot;')
      .replaceAll("'", '&#39;');
  }

  // ---- Persistence helpers ----
  function loadPetsFromStorage() {
    const raw = localStorage.getItem(PETS_KEY);
    let pets = [];
    try {
      pets = raw ? JSON.parse(raw) : [];
      if (!Array.isArray(pets)) pets = [];
    } catch (e) {
      pets = [];
    }
    return pets;
  }

  function savePetsToStorage(pets) {
    localStorage.setItem(PETS_KEY, JSON.stringify(pets));
  }

  // ---- Render all saved pets ----
  function renderAllPets() {
    petListEl.innerHTML = '';
    const pets = loadPetsFromStorage();
    pets.forEach(p => {
      petListEl.appendChild(createPetCard(p));
    });
  }

  // ---- Add pet object (appends to DOM + storage) ----
  function addPet(pet) {
    // Append to DOM right away
    petListEl.appendChild(createPetCard(pet));

    // Save
    const pets = loadPetsFromStorage();
    pets.push(pet);
    savePetsToStorage(pets);
  }

  // ---- Convert selected file to dataURL if present; returns Promise ----
  function fileToDataUrl(file) {
    return new Promise((resolve, reject) => {
      if (!file) return resolve(null);
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  // ---- Form submit handler (Add Pet) ----
  form.addEventListener('submit', async (ev) => {
    ev.preventDefault();

    const name = document.getElementById('petname').value.trim();
    const species = document.getElementById('species').value.trim();
    const dob = document.getElementById('dob').value; // date input returns yyyy-mm-dd
    const diet = document.getElementById('diet').value.trim();
    const notes = document.getElementById('notes').value.trim();
    const photoFile = photoInput.files && photoInput.files[0];

    // Minimal validation
    if (!name) {
      alert('Please enter a pet name.');
      return;
    }

    // Convert photo to data URL so it can be shown and persisted
    let photoDataUrl = null;
    try {
      photoDataUrl = await fileToDataUrl(photoFile);
    } catch (e) {
      console.warn('Could not read photo file', e);
    }

    const petObj = { name, species, dob, diet, notes, photoDataUrl, createdAt: new Date().toISOString() };

    addPet(petObj);

    // Clear form
    form.reset();

    // Optionally scroll to newly added pet
    petListEl.lastElementChild?.scrollIntoView({ behavior: 'smooth' });
  });

  // ---- When page loads, render stored pets ----
  renderAllPets();

  // ---- Listen for pending pet added by another page (e.g., survey.html) ----
  function checkForPendingPet() {
    const pendingRaw = localStorage.getItem(PENDING_KEY);
    if (!pendingRaw) return;
    try {
      const pending = JSON.parse(pendingRaw);
      if (pending && pending.name) {
        addPet(pending);
      }
    } catch (e) {
      console.warn('Invalid pending pet in storage', e);
    } finally {
      // Remove the pending item so it's not added repeatedly
      localStorage.removeItem(PENDING_KEY);
    }
  }

  // If the survey redirected here, there might be a pending pet already
  checkForPendingPet();

  // Also listen for storage events (if survey page is open in another tab and writes PENDING_KEY)
  window.addEventListener('storage', (ev) => {
    if (ev.key === PENDING_KEY && ev.newValue) {
      checkForPendingPet();
    }
  });

});
</script>

</body>
</html>

